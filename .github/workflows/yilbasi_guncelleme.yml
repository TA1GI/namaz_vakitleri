name: Namaz Vakitlerini Güncelle

on:
  workflow_dispatch:
  schedule:
    # 1 Ocak ile 10 Ocak arasında, her saat başı çalıştır
    - cron: '0 * 1-10 1 *'

permissions:
  contents: write

jobs:
  veri-cek-ve-kaydet:
    runs-on: ubuntu-latest

    steps:
    - name: Repoyu Getir (Checkout)
      uses: actions/checkout@v4

    - name: PHP Kurulumu
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.2'
        extensions: curl, json, mbstring

    - name: PHP Botunu Çalıştır
      run: php namaz_vakitleri_bot.php

    - name: Kurulum - Node.js (CAPTCHA takılan ilçeler için)
      uses: actions/setup-node@v3
      with:
        node-version: '20.x'
        
    - name: Paketleri Yükle (Puppeteer)
      run: npm install

    - name: Puppeteer Botunu Çalıştır (Eksik 9 ilçe)
      run: node puppeteer_bot.js

    - name: Değişiklikleri Kaydet ve Gönder
      run: |
        git config --global user.name "Namaz Vakitleri Botu"
        git config --global user.email "actions@github.com"
        
        # Ana dizindeki tüm JSON dosyalarını ekle
        git add *.json
        
        # Eğer bir arşiv klasörü oluşmuşsa onu da ekle (Örn: 2025/*.json)
        # Hata vermemesi için "varsa ekle" mantığı:
        git add 20*/*.json 2>/dev/null || true
        
        # Değişiklik varsa commit yap ve gönder
        git diff --quiet && git diff --staged --quiet || (git commit -m "Otomatik Veri Güncellemesi: $(date +'%Y-%m-%d %H:%M')" && git push)